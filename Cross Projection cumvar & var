
import numpy as np
from sklearn.decomposition import PCA
import matplotlib.pyplot as plt

# Load the data
pre = np.nan_to_num(np.load("C:/Users/zheng/OneDrive/Desktop/Bachelor/F0254/events_pre.npy"))
post = np.nan_to_num(np.load("C:/Users/zheng/OneDrive/Desktop/Bachelor/F0254/events_post.npy"))

# Flatten the data for PCA
pre_flat = pre.reshape(pre.shape[0], -1)
post_flat = post.reshape(post.shape[0], -1)

# Perform PCA on pre and post data
n_components = 13
pca_pre = PCA(n_components=n_components)
pre_pca_result = pca_pre.fit_transform(pre_flat)
pre_pcs = pca_pre.components_  # Principal components of pre

pca_post = PCA(n_components=n_components)
post_pca_result = pca_post.fit_transform(post_flat)
post_pcs = pca_post.components_  # Principal components of post

# Cross-projection: Pre-to-Post and Post-to-Pre
pre_to_post_proj = np.dot(pre_flat, post_pcs.T)
post_to_pre_proj = np.dot(post_flat, pre_pcs.T)

# Self-projections
pre_to_pre_proj = np.dot(pre_flat, pre_pcs.T)
post_to_post_proj = np.dot(post_flat, post_pcs.T)

# Variance Calculation
pre_to_post_var = np.var(pre_to_post_proj, axis=0)
pre_to_pre_var = np.var(pre_to_pre_proj, axis=0)
post_to_pre_var = np.var(post_to_pre_proj, axis=0)
post_to_post_var = np.var(post_to_post_proj, axis=0)

# Cumulative Variance
pre_to_post_cumulative_var = np.cumsum(pre_to_post_var) / np.sum(pre_to_post_var)
pre_to_pre_cumulative_var = np.cumsum(pre_to_pre_var) / np.sum(pre_to_pre_var)
post_to_pre_cumulative_var = np.cumsum(post_to_pre_var) / np.sum(post_to_pre_var)
post_to_post_cumulative_var = np.cumsum(post_to_post_var) / np.sum(post_to_post_var)

# ** Plotting Cumulative Variance **

# Pre onto Pre and Post (Cumulative)
plt.figure(figsize=(12, 6))
plt.plot(range(1, n_components + 1), pre_to_pre_cumulative_var, label="Pre to Pre", marker="o", color="green")
plt.plot(range(1, n_components + 1), pre_to_post_cumulative_var, label="Pre to Post", marker="o", color="blue")
plt.title("Cumulative Variance: Pre Patterns Projected onto Pre and Post PCs")
plt.xlabel("Pre Patterns (Number of Principal Components)")
plt.ylabel("Cumulative Variance Explained")
plt.xticks(range(1, n_components + 1))
plt.legend()
plt.grid()
plt.show()

# Post onto Pre and Post (Cumulative)
plt.figure(figsize=(12, 6))
plt.plot(range(1, n_components + 1), post_to_post_cumulative_var, label="Post to Post", marker="o", color="red")
plt.plot(range(1, n_components + 1), post_to_pre_cumulative_var, label="Post to Pre", marker="o", color="orange")
plt.title("Cumulative Variance: Post Patterns Projected onto Pre and Post PCs")
plt.xlabel("Post Patterns (Number of Principal Components)")
plt.ylabel("Cumulative Variance Explained")
plt.xticks(range(1, n_components + 1))
plt.legend()
plt.grid()
plt.show()

# ** Plotting Normal Variance **

# Pre onto Pre and Post (Normal Variance)
plt.figure(figsize=(12, 6))
plt.plot(range(1, n_components + 1), pre_to_pre_var, label="Pre to Pre", marker="o", color="green", linestyle='--')
plt.plot(range(1, n_components + 1), pre_to_post_var, label="Pre to Post", marker="o", color="blue", linestyle='--')
plt.title("Normal Variance: Pre Patterns Projected onto Pre and Post PCs")
plt.xlabel("Pre Patterns (Number of Principal Components)")
plt.ylabel("Variance Explained")
plt.xticks(range(1, n_components + 1))
plt.legend()
plt.grid()
plt.show()

# Post onto Pre and Post (Normal Variance)
plt.figure(figsize=(12, 6))
plt.plot(range(1, n_components + 1), post_to_post_var, label="Post to Post", marker="o", color="red", linestyle='--')
plt.plot(range(1, n_components + 1), post_to_pre_var, label="Post to Pre", marker="o", color="orange", linestyle='--')
plt.title("Normal Variance: Post Patterns Projected onto Pre and Post PCs")
plt.xlabel("Post Patterns (Number of Principal Components)")
plt.ylabel("Variance Explained")
plt.xticks(range(1, n_components + 1))
plt.legend()
plt.grid()
plt.show()
